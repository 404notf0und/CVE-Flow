import configparser
from lib.cve_feeds import cve_monitor
from lib.exp_label import exp_init,exp_add,exp_all
from lib.exp_predict import exp_model
from lib.visualization import draw_report

def auto_run():
    conf=configparser.ConfigParser()
    conf.read('conf/info.conf')
    monitor_init=conf.get('CVE_Feeds','init')
    label_init=conf.get('CVE_Label','init')
    # CVE数据解析、入库
    ret,cve_day,exp_day=cve_monitor(monitor_init)
    # 第三方EXP数据解析、入库
    if label_init=='True':
        exp_init()
    else:
        third_part_exp_add=exp_add()
        third_part_exp_add={**exp_day,**third_part_exp_add}
    third_part_exp_all=exp_all()
    print(third_part_exp_add)
    # 训练模型:third_part_exp_all（过去）
    exp_proba=exp_model(delta=-1)
    print(exp_proba)
    # 输出报告：过去数据和visualization（过去），当天新增cve及exp数据（cve_day,exp_day,third_part_exp_add）（现在），exp预测结果exp_proba（未来）
    draw_report(exp_proba,third_part_exp_add)
    print('[+] Done!')

if __name__=="__main__":
    auto_run()

    