from cve_label import nvd_nist
import pandas as pd
from sqlite import SQLite

def sql2cve(so,sql):
    """
    返回cve id和desc
    """
    r=so.query(sql)
    ids=[]
    desc=[]
    for i in r:
        ids.append(i[0])
        desc.append(i[1])
    ids=pd.DataFrame(ids,columns=['id'])
    desc=pd.DataFrame(desc,columns=['desc'])
    cve=pd.concat([ids,desc],axis=1)

    return cve

def load():
    """
    载入nvd.nist原始exp标记数据
    """
    # 取CVE exp白样本
    so=SQLite('data/nvd.db')
    sql='select CVE_Items_cve_CVE_data_meta_ID,CVE_Items_cve_description_description_data_value from nvd_cve where CVE_Items_cve_references_reference_data_tags not like "%Exploit%"'
    cve_0=sql2cve(so,sql)
    cve_0['label']=0

    # 取CVE exp黑样本
    sql='select CVE_Items_cve_CVE_data_meta_ID,CVE_Items_cve_description_description_data_value from nvd_cve where CVE_Items_cve_references_reference_data_tags like "%Exploit%"'
    cve_1=sql2cve(so,sql)
    cve_1['label']=1

    cve=pd.concat([cve_0,cve_1])
    print(cve.head())
    cve.to_csv('cve2.csv',index=False)
    return cve



if __name__ == '__main__':
    load()